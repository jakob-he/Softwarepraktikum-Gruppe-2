<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Microarray Analysis">
    <meta name="author" content="Colin Gundlach, Jakob Hertzberg">
    <title>Microarray Analysis</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Microarray Analysis</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">File Upload</a></li>
            <li><a href="Download.html"> Download </a></li>
          </ul>
        </div>
      </div>
    </nav>


    </script>
    <div class="container">

      <div class="starter-template">
        <h1>File Upload</h1>
        <p class="lead">
          <div id="uploads"></div>
          <div class="dropzone" id="dropzone"> Drop CEL-files here to upload</div>

          <script>
            (function() {
              var dropzone = document.getElementById("dropzone");


              var zipping = function(string) {
                var zip= new XMLHttpRequest();


                zip.open("post","php_script/zip.php");
                zip.send(string);

                zip.onload = function() {
                  var zipdata = this.responseText;

                  console.log(zipdata);
                  if (zipdata=="OK") {
                      document.getElementById('dropzone').innerHTML = "All done! Drop new Data";
                  }
                }
              }

              var upload = function(files){
                var formData = new FormData(),
                  xhr= new XMLHttpRequest(),
                  x;

                  for(x = 0; x < files.length; x = x + 1){
                    formData.append("file[]",files[x]);
                  }

                  xhr.onload = function() {
                    var uploaddata = this.responseText;

                    console.log(uploaddata);
                    if (uploaddata=="OK") {
                        document.getElementById('dropzone').innerHTML = "analyzing...";
                    }
                  }

                  xhr.open("post","php_script/upload.php");
                  xhr.send(formData);

                  var analysis= new XMLHttpRequest();
                  analysis.open("post","php_script/rtest.php");
                  analysis.send("go");

                  analysis.onload = function() {
                    var analysisdata = this.responseText;

                    console.log(analysisdata);
                    if (analysisdata=="OK") {
                        document.getElementById('dropzone').innerHTML = "zipping...";
                    }
                    zipping(analysisdata);
                  }


              }

              dropzone.ondrop =function(e){
                e.preventDefault();
                this.className = "dropzone";
                upload(e.dataTransfer.files);
              };

              dropzone.ondragover = function(){
                this.className="dropzone dragover"
                return false;
              };

              dropzone.ondragleave =function(){
                this.className="dropzone"
                return false;
              };

            }());

          </script>
        </p>
      </div>

    </div>
    <div class="container">





  </body>
</html>
